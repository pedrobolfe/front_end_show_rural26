<!-- Header Component -->
<app-header [showLogoutButton]="true" (onLogout)="logout()"></app-header>

<div class="home-container">
  <div class="home-card">
    <!-- User Info -->
    <div class="user-info" *ngIf="user()">
      <div class="user-details">
        <h2 class="user-name">Ol치, {{ user()?.name }}</h2>
        <p class="user-car">CAR: {{ user()?.numCRA }}</p>
      </div>
    </div>

    <!-- Carbon Status Section (Compact) -->
    <div class="carbon-status-compact" *ngIf="user()?.lastReportDate">
      <div class="carbon-header">
        <h3>游늵 Status de Carbono</h3>
        <span class="carbon-status-badge" [ngClass]="getStatusClass(user()?.statusCarbono || 'NEUTRO')">
          {{ getStatusText(user()?.statusCarbono || 'NEUTRO') }}
        </span>
      </div>
      <div class="carbon-row">
        <div class="carbon-col">
          <span class="label">Emiss칫es</span>
          <span class="value emissions">{{ user()?.totalEmissoes || 0 | number:'1.1-1' }}</span>
        </div>
        <div class="carbon-col">
          <span class="label">Remo칞칫es</span>
          <span class="value removals">{{ user()?.totalRemocoes || 0 | number:'1.1-1' }}</span>
        </div>
        <div class="carbon-col">
          <span class="label">Balan칞o</span>
          <span class="value" [ngClass]="getBalanceClass(user()?.balancoLiquido || 0)">{{ user()?.balancoLiquido || 0 | number:'1.1-1' }}</span>
        </div>
      </div>
      <p class="carbon-date">칔ltimo relat칩rio: {{ user()?.lastReportDate | date:'dd/MM/yyyy' }}</p>
    </div>

    <!-- Action Buttons -->
    <div class="action-section">
      <button class="btn-action" (click)="editQuestionario()">
        <span class="icon">游닇</span>
        <div class="action-content">
          <h3>Editar Question치rio</h3>
          <p>Atualizar informa칞칫es da propriedade</p>
        </div>
      </button>

      <button class="btn-action btn-generate" (click)="generateRelatorio()" [disabled]="generatingReport()">
        <span class="icon" [class.animating]="generatingReport()">游</span>
        <div class="action-content">
          <h3>{{ generatingReport() ? 'Gerando Relat칩rio...' : 'Gerar Relat칩rio' }}</h3>
          <p>{{ generatingReport() ? 'Aguarde, processando an치lise' : 'Criar novo invent치rio de carbono' }}</p>
        </div>
      </button>
    </div>

    <!-- Relatorios Section -->
    <div class="relatorios-section">
      <h2 class="section-title">Meus Relat칩rios</h2>

      <div class="loading" *ngIf="loading()">
        <div class="spinner"></div>
        <p>Carregando relat칩rios...</p>
      </div>

      <div class="error-message" *ngIf="errorMessage()">
        {{ errorMessage() }}
      </div>

      <div class="empty-state" *ngIf="!loading() && relatorios().length === 0 && !errorMessage()">
        <span class="empty-icon">游늯</span>
        <h3>Nenhum relat칩rio dispon칤vel</h3>
        <p>Seus relat칩rios aparecer칚o aqui quando estiverem prontos</p>
      </div>

      <div class="relatorios-list" *ngIf="!loading() && relatorios().length > 0">
        <div class="relatorio-card" *ngFor="let relatorio of relatorios()">
          <div class="relatorio-header">
            <h3 class="relatorio-title">{{ relatorio.title }}</h3>
            <span class="badge" [ngClass]="getStatusBadgeClass(relatorio.status)">
              {{ getStatusText(relatorio.status) }}
            </span>
          </div>

          <div class="relatorio-info">
            <p class="relatorio-type">
              <strong>Tipo:</strong> {{ relatorio.type === 'inventario' ? 'Invent치rio' : 'An치lise' }}
            </p>
            <p class="relatorio-date">
              <strong>Criado em:</strong> {{relatorio.createdAt | date:'dd/MM/yyyy HH:mm' }}
            </p>
          </div>

          <button
            class="btn-download"
            (click)="downloadRelatorio(relatorio)"
          >
            Baixar Relat칩rio
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
